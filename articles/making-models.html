<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating new ss3sim model setups • ss3sim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Creating new ss3sim model setups">
<meta property="og:description" content="ss3sim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ss3sim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.20.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to ss3sim</a>
    </li>
    <li>
      <a href="../articles/making-models.html">Creating new ss3sim model setups</a>
    </li>
    <li>
      <a href="../articles/modifying-models.html">Modifying the model included with ss3sim</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ss3sim/ss3sim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating new ss3sim model setups</h1>
            
            <h4 data-toc-skip class="date">2022-12-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ss3sim/ss3sim/blob/HEAD/vignettes/making-models.Rmd" class="external-link"><code>vignettes/making-models.Rmd</code></a></small>
      <div class="hidden name"><code>making-models.Rmd</code></div>

    </div>

    
    
<p>In some cases you may wish to adapt your own Stock Synthesis model to
work with ss3sim. This is possible but may be difficult. The functions
in {ss3sim} were developed to work with the existing model setups, and a
model with a different structure may lead to incomprehensible error
messages because it is extremely difficult to write auxiliary functions
that will interact reliably with all the available options in Stock
Synthesis. For this reason, we recommend that users strongly consider
trying to <a href="modifying-models.html">modify an existing model
rather than creating a new one</a>.</p>
<p>For those users who choose to create a new {ss3sim} model setup, we
outline below the steps needed to take an existing Stock Synthesis model
and modify it to work with {ss3sim}.</p>
<div class="section level2">
<h2 id="overall-file-structure">Overall file structure<a class="anchor" aria-label="anchor" href="#overall-file-structure"></a>
</h2>
<p><a href="#om-setup">OM</a> folders should have the following
files:</p>
<pre><code><span><span class="va">yourOMmodel.ctl</span></span>
<span><span class="va">yourOMmodel.dat</span></span>
<span><span class="va">starter.ss</span></span>
<span><span class="va">forecast.ss</span></span></code></pre>
<p><a href="#em-setup">EM</a> folders should have the following
files:</p>
<pre><code><span><span class="va">yourEMmodel.ctl</span></span>
<span><span class="va">starter.ss</span></span>
<span><span class="va">forecast.ss</span></span></code></pre>
<p>The names of the <code>.ctl</code> and <code>.dat</code> files are
not important. The wrapper functions within ss3sim will rename the files
when copying them to appropriate folders. These files should be derived
from <code>.ss_new</code> files but have the file extensions as shown
above. It is important to use <code>.ss_new</code> files so the files
have consistent formatting. Many of the functions in this package and
{r4ss} depend on that formatting.</p>
</div>
<div class="section level2">
<h2 id="om-setup">Setting up a new operating model<a class="anchor" aria-label="anchor" href="#om-setup"></a>
</h2>
<p>The main purpose of the operating model (OM) is to generate data
files that can used for the estimation model (EM). The initial data file
stored in the OM folder does not have to contain actual data but it does
need to contain enough information for the executable to run. For
example, if age-composition data are turned on, then at least one row of
age-composition data must be in the file. The actual composition
information in this row of data can be any numeric value and does not
have to make sense biologically because the compositions will be
replaced with expected values and then sampled values. If dynamic
binning is desired, the OM data file should have all desired
combinations of bins that will be used in the sampled scenarios (see the
<a href="introduction.html#change-data">section in the Introduction
vignette on dynamic binning</a> for more details). Specifically, OM bins
for the data must be at least as small as the smallest bins desired but
not smaller than the population bins so that they can easily be
re-binned.</p>
<p>The first step to setting up an OM is to run Stock Synthesis using
your original files to make sure the model runs and estimates parameters
as desired. Thus, open a command window inside the folder with your
original files and run Stock Synthesis. If Stock Synthesis is not in
your path (<a href="introduction.html">see the Introduction
vignette</a>), you will need to have the executable available in this
folder. Note that there may be an error message in the command window
indicating that ADMB cannot find the data file. ADMB expects a certain
name and Stock Synthesis uses a name stored in the starter file. You can
safely ignore this error. Once the model is finished running, it will
generate a number of files, including <code>.ss_new</code> files. Copy
the needed <code>.ss_new</code> files to the OM folder and remove the
<code>.ss_new</code> file extension and add the appropriate file
extensions. Do the same for the files needed for the EM. Use the
<code>.ss_new</code> files produced as a starting point to ensure that
your Stock Synthesis input files are properly formatted.</p>
<p>We recommend opening a command window inside your OM and EM folders
to test if the model still runs at many points along the process. First,
turn parameter estimation off in the OM starter file (see below) and run
<code>ss -nohess</code> to make sure the input files are read in
properly and the model writes the new input files.</p>
<div class="section level3">
<h3 id="forecast-file-modifications">Forecast file modifications<a class="anchor" aria-label="anchor" href="#forecast-file-modifications"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Set <code># Do West Coast gfish rebuilder output (0/1)</code> to
0.</p></li>
<li><p>Optionally, comment out the lines below specifying the years of
the rebuilding plan.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="starter-file-modifications">Starter file modifications<a class="anchor" aria-label="anchor" href="#starter-file-modifications"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Turn off parameter estimation by changing
<code># Turn off estimation for parameters entering after this phase</code>
to <code>0</code>.</p></li>
<li><p>Use the INIT values in the <code>.ctl</code> file to initialize
model parameters for your population. To do so, change
<code># use init values in Starter file</code> to <code>0</code>. The
<code>.par</code> file will be ignored.</p></li>
<li><p>Generate detailed report files, containing age-structure
information, by setting
<code># detailed age-structured reports in REPORT.SSO</code> to
<code>1</code>.</p></li>
<li><p>Generate data by setting
<code># Number of datafiles to produce</code> to <code>3</code>. If
<code>X=1</code> it only generates the original data. If
<code>X=2</code> it generates the original data and the expected value
data (based on model specification). If <code>X&gt;=3</code> it
generates all the above and <code>X-2</code> bootstrapped data
sets.</p></li>
<li><p>Turn off parameter jittering by setting
<code># jitter initial parm value by this fraction</code> to
<code>0</code>. The OM is used as the truth so jittering is not
needed.</p></li>
<li><p>Turn off retrospective analyses by setting
<code># retrospective year relative to end year</code> to
<code>0</code>.</p></li>
<li><p>Specify how catch is reported by setting
<code># F_report_units</code> to <code>1</code> if catch is reported in
biomass or <code>2</code> if catch is reported in numbers. Additionally,
comment out the next line,
<code>#_min and max age over which average F will be calculated</code>,
by removing all characters prior to the hash symbol.</p></li>
<li><p>Implement catches using instantaneous fishing mortality by
changing <code># F_report_basis</code> to <code>0</code>. Instantaneous
fishing mortality is used rather than catches in numbers or biomass to
run the OM, which ensures that the resulting catches will be less than
the available biomass for every given year. Where, if we allowed users
to specify catch in numbers or biomass they might crash the
population.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="control-file-modifications">Control file modifications<a class="anchor" aria-label="anchor" href="#control-file-modifications"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Specify all environmental deviates on biological parameters to be
unconstrained by bounds by setting
<code>#_env/block/dev_adjust_method</code> to <code>1</code>. If the
method is set to <code>2</code>, parameters adjusted using
environmental-covariate inputs will be adjusted using a logistic
transformation. The logistic transformation ensures that the adjusted
parameter will stay within the bounds of the base parameter. If it
exists and is not already commented out, comment out the second line
entitled <code>#_env/block/dev_adjust_method</code> underneath the
section which specifies selectivity parameters. If time-varying
selectivity parameters are added using the <code><a href="../reference/change_tv.html">change_tv()</a></code>
function, this line will be modified by the same function.</p></li>
<li><p>Turn on recruitment deviations by specifying
<code>#do_recdev</code> to <code>1</code>. Using the next two lines,
specify the use of recruitment deviations to begin and end with the
start and end years of the model.</p></li>
<li><p>Turn on additional advanced options for the recruitment
deviations by specifying
<code># (0/1) to read 13 advanced options</code> to
<code>1</code>.</p></li>
<li><p>Set <code>#_recdev_early_start</code> to <code>0</code> so that
the model will use the
<code># first year of main recr_devs</code>.</p></li>
<li><p>Set
<code>#_lambda for Fcast_rec_like occurring before endyr+1</code> to
<code>1</code>. This lambda is for the log likelihood of the forecast
recruitment deviations that occur before the first year of forecasting.
Values larger than one accommodate noisy data at the end of the time
series.</p></li>
<li><p>Recruitment is log-normally distributed in Stock Synthesis. If
inputting a normally distributed recruitment deviations specify
<code>#_max_bias_adj_in_MPD</code> to <code>-1</code> so that Stock
Synthesis performs the bias correction for you. {ss3sim} internally uses
bias corrected normal recruitment deviations, unless users specify
<code>user_recdevs</code>, which do not need bias correction and users
should specify <code>#_max_bias_adj_in_MPD</code> to
<code>0</code>.</p></li>
<li><p>Use any negative value in line <code># F ballpark year</code>, to
disable the use of a ballpark year to determine fishing mortality
levels.</p></li>
<li><p>Specify <code># F_Method</code> to <code>2</code>, which
facilitates the use of a vector of instantaneous fishing mortality
levels. The max harvest rate in the subsequent line will depend upon the
fishing mortality levels in your simulation. Following the max harvest
rate, specify a line with three values separated by spaces. The first
value is the overall start F value, followed by the phase. The last
value is the number of inputs. Set the number of inputs to
<code>1</code> because <code>change_f</code> will be used to input a
vector of fishing mortality levels. Next, specify a single line with six
values, separated by spaces, where the values correspond to fleet
number, start year, season, fishing mortality level, the standard error
of the fishing mortality level, and a negative phase value, e.g.,
<code>1 1 1 0 0.01 -1</code>.</p></li>
<li>
<p>Remove non-terminator lines in
<code># Input variance adjustments factors</code> or set all elements in
the <code>Value</code> column to <code>0</code>. For example, your file
could look like the following:</p>
<pre><code># Input variance adjustments factors: 
 #_1=add_to_survey_CV
 #_2=add_to_discard_stddev
 #_3=add_to_bodywt_CV
 #_4=mult_by_lencomp_N
 #_5=mult_by_agecomp_N
 #_6=mult_by_size-at-age_N
 #_7=mult_by_generalized_sizecomp
#_Factor  Fleet  Value
 -9999   1    0  # terminator</code></pre>
</li>
<li>
<p>Remove non-terminator lines in <code>#_maxlambdaphase</code> or
set all elements in the <code>value</code> column to <code>0</code>. For
example, your file could look like the following:</p>
<pre><code>1 #_maxlambdaphase
1 #_sd_offset; must be 1 if any growthCV, sigmaR, or survey extraSD is an estimated parameter
# read 0 changes to default Lambdas (default value is 1.0)
# Like_comp codes:  1=surv; 2=disc; 3=mnwt; 4=length; 5=age; 6=SizeFreq; 7=sizeage; 8=catch; 9=init_equ_catch; 
# 10=recrdev; 11=parm_prior; 12=parm_dev; 13=CrashPen; 14=Morphcomp; 15=Tag-comp; 16=Tag-negbin; 17=F_ballpark; 18=initEQregime
#like_comp fleet  phase  value  sizefreq_method
-9999  1  1  1  1  #  terminator</code></pre>
</li>
<li><p>If desired, change the initial, i.e., <code>INIT</code>, values
of the growth, selectivity, etc. parameters to specify the dynamics of
the OM. In theory, these will not need to be altered because they will
be based on what was estimated in your production stock assessment
model.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="data-file-modifications">Data file modifications<a class="anchor" aria-label="anchor" href="#data-file-modifications"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Specify the start and end year for the simulation by modifying
<code>#_StartYr</code> and <code>#_EndYr</code>. Years can be specified
as a number line (i.e., <code>1</code> and <code>5</code>) or as actual
years (i.e., <code>2001</code> and <code>2005</code>).</p></li>
<li><p>Specify the fleet_type, sample_timing, fleet_area (1), units,
catch_mult, and fleet name with one row per fleet after
<code>#_Nfleets</code> and before
<code>#Bycatch_fleet_input_goes_next</code>.</p></li>
<li><p>Turn off mean body weight observations by setting
<code>#_use meanbodysize_data</code> to <code>0</code> because {ss3sim}
currently does not have the capability to sample these data.</p></li>
<li><p>Set <code># length bin method</code> to <code>1</code> or
<code>2</code>. Using a value of <code>1</code>, the bins refer to the
data bins (specified later). Using a value of <code>2</code> instructs
Stock Synthesis to generate the bin widths from a user specified minimum
and maximum value. In the following three lines, specify the bin width
for population size composition data; the minimum size, or the lower
edge of the first bin and size at age zero; and the maximum size, or
lower edge of the last bin. The length data bins MUST be wider than the
population bins but the boundaries do not have to align.</p></li>
<li><p>Turn off <code>#_mintailcomp</code> using any negative value for
each fleet.</p></li>
<li><p>Specify <code>addtocomp</code> to a very small number for each
fleet, e.g., <code>1e-005</code>. <code>addtocomp</code> represents the
amount that is added to each composition (age and length) data bin such
that the likelihood is always computable.</p></li>
<li><p>Set <code>#_Lbin_method_for_Age_Data</code> for ages (used when
the conditional-age-at-length data exists) to <code>1</code>,
<code>2</code>, or <code>3</code> depending on the data you have or the
purpose of the study.</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="em-setup">Setting up a new estimation model<a class="anchor" aria-label="anchor" href="#em-setup"></a>
</h2>
<p>Unlike the OM, the EM needs to be a valid Stock Synthesis model and
be able to successfully estimate parameters and their standard errors
using maximum likelihood estimates. Thus, the OM needs to be adapted to
create a new EM. The preferred method here is to run
<code><a href="../reference/create_em.html">create_em()</a></code> using the newly created OM files.</p>
<div class="section level3">
<h3 id="testing-the-new-estimation-model">Testing the new estimation model<a class="anchor" aria-label="anchor" href="#testing-the-new-estimation-model"></a>
</h3>
<p>After completing the above steps run the models manually one last
time. Verify that the data are read in correctly and expected values of
the population dynamics are written to the <code>.dat</code> files and
sensical. Verify that the EM loads the data properly and the objective
function value (negative log-likelihood) is sensible. If it works
correctly, try running deterministic simulations on the model (see the
<a href="introduction.html#deterministic">Introduction vignette</a>) and
further verify that ss3sim functions that modify the EM (e.g.,
<code>change_e</code>) act correctly on the model setup. The help files
for the functions demonstrate how to use the functions to test models.
Note that the OM will not be a valid Stock Synthesis model in the sense
that ADMB cannot run and produce maximum likelihood estimates of
parameters; it is intended to only be run for one iteration to generate
the population dynamics using values specified in the input files.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kelli F. Johnson, Sean C. Anderson, Kathryn L. Doering, Cole C. Monnahan, Christine C. Stawitz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
