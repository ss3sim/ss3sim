<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to ss3sim • ss3sim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to ss3sim">
<meta property="og:description" content="Start here to learn how to use ss3sim. Basic information is provided on key functions, e.g., `run_ss3sim()`, and available outputs.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ss3sim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.21.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to ss3sim</a>
    </li>
    <li>
      <a href="../articles/making-models.html">Creating new ss3sim model setups</a>
    </li>
    <li>
      <a href="../articles/modifying-models.html">Modifying the model included with ss3sim</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ss3sim/ss3sim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to ss3sim</h1>
            
            <h4 data-toc-skip class="date">2025-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ss3sim/ss3sim/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>This vignette is a good starting place for learning about
{ss3sim}.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>{ss3sim} is an R package to simplify the steps needed to generate
beautiful simulation output from <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis" title="Stock Synthesis (SS3) github repository" class="external-link">Stock Synthesis
(SS3)</a>. If you need help learning R prior to using {ss3sim}, we
recommend navigating to the <a href="https://blog.rstudio.org/" title="RStudio Blog" class="external-link">RStudio Blog</a>.</p>
<p>{ss3sim} consists of</p>
<ul>
<li>a series of low-level functions that facilitate manipulating Stock
Synthesis configuration files, running Stock Synthesis models, and
combining the output;</li>
<li>a few high-level wrapper functions that control simulation
experiments, e.g., <code><a href="../reference/run_ss3sim.html">run_ss3sim()</a></code>; and</li>
<li>documentation for the user, e.g., <code><a href="../reference/change_f.html">?change_f</a></code>, vignettes,
<a href="https://github.com/ss3sim/ss3sim/issues" title="ss3sim issue tracker on GitHub" class="external-link">issue tracker</a>, and a <a href="https://github.com/ss3sim/ss3sim/discussions" title="ss3sim Discussions on GitHub" class="external-link">Discussion board</a> for users and
developers to interact.</li>
</ul>
<p>The developers of {ss3sim} strive to facilitate an inviting place
where all individuals feel welcome. Please see the <a href="https://github.com/nmfs-fish-tools/Resources/blob/main/CODE_OF_CONDUCT.md" title="Code of Conduct" class="external-link">Code of Conduct</a> that we abide by to ensure
contributors are valued and <a href="https://github.com/nmfs-fish-tools/Resources/blob/main/CONTRIBUTING.md" title="Contributor guidelines" class="external-link">Contributor Guidelines</a> for how to
contribute.</p>
<div class="section level3">
<h3 id="stock-synthesis">Stock Synthesis<a class="anchor" aria-label="anchor" href="#stock-synthesis"></a>
</h3>
<p>It seems imperative to first describe <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis" title="Stock Synthesis (SS3) github repository" class="external-link">Stock Synthesis</a>
because without Stock Synthesis there would not be {ss3sim}. Stock
Synthesis is an integrated statistical catch-at-age model written in <a href="https://www.admb-project.org/community/" title="AD model builder project" class="external-link">ADMB</a>. The software is widely used
across the globe and has been around for 40+ years.</p>
<p>The inspiration for {ss3sim} came from Hui-Hua Lee’s hooilator
software. hooliator parsed <code>data.ss_new</code> files into multiple
files and created a consistent directory structure to store the results.
As of Stock Synthesis 3.30.19, the need to separate out the
<code>data.ss_new</code> file into separate files is no longer necessary
because Stock Synthesis itself now ports the output into separate files,
i.e., the echoed data are in <code>data_echo.ss_new</code>, the expected
values are in <code>data_expval.ss</code>, and simulated data sets are
in <code>data_boot_**N.ss</code>. See the <a href="https://nmfs-stock-synthesis.github.io/ss-documentation/SS330_User_Manual.html#output-files" title="Stock Synthesis output file documentation" class="external-link">section on output
files in the Stock Synthesis manual</a> for more detailed information.
{ss3sim} finishes the creation of simulation-specific directories
similar to the directory structure that was created by hooliator.
{ss3sim} adds functionality to sample from the expected values such that
simulations need not rely on bootstrapped values provided in
<code>data_boot_**N.ss</code>. With a plethora of simulation output
stored in structured folders, there was an imminent need for functions
to visualize the results. <a href="https://ggplot2.tidyverse.org/" title="ggplot2 documentation" class="external-link">{ggplot2}</a> was gaining traction at the
time and shaped how we thought about things, including our <a href="#overview">mission statement</a> and <a href="beautiful-output">example output</a>.</p>
<p>{ss3sim} is just a minor part of the suite of functionality available
for Stock Synthesis. See the <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis" title="Stock Synthesis (SS3) github repository" class="external-link">Stock Synthesis
website</a> for a list of additional software.</p>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<div class="section level4">
<h4 id="installing-ss3sim">Installing {ss3sim}<a class="anchor" aria-label="anchor" href="#installing-ss3sim"></a>
</h4>
<p>{ss3sim} is available on <a href="https://cran.r-project.org/package=ss3sim" title="ss3sim on CRAN" class="external-link">CRAN</a> and <a href="https://github.com/ss3sim/ss3sim/releases" title="ss3sim on GitHub" class="external-link">GitHub</a> and can be run on OS X, Windows, or
Linux. The GitHub branch “main” contains the newest features, which are
more than likely not available on CRAN. We recommend using the GitHub
version because development of {ss3sim} is very fluid and new features
are added almost monthly, whereas CRAN submissions tend to be
bi-annual.</p>
<p>Run the following code to install {ss3sim} and load it into your
workspace. You will not need to install {ss3sim} every time but it is a
good idea to ensure it is up to date. If you are installing from GitHub,
you may need to install {remotes} or {pak},
<code>utils::install.packges("pak")</code>, before installing {ss3sim}
if you do not already have {devtools} installed. If your current version
of {ss3sim} is up to date, R will let you know and prompt you if you
want to override the current installation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span></span>
<span>  pkg <span class="op">=</span> <span class="st">"ss3sim/ss3sim"</span>,</span>
<span>  <span class="co"># pkg = "ss3sim" # CRAN version</span></span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/ss3sim/ss3sim" class="external-link">"ss3sim"</a></span><span class="op">)</span></span></code></pre></div>
<p>The following code demonstrates how to access the {ss3sim}
documentation within R. You can also view the <a href="https://ss3sim.github.io/ss3sim/" title="ss3sim website hosted on GitHub" class="external-link">vignettes online</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ss3sim</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"ss3sim"</span><span class="op">)</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseVignettes.html" class="external-link">browseVignettes</a></span><span class="op">(</span><span class="st">"ss3sim"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="path">Installing Stock Synthesis<a class="anchor" aria-label="anchor" href="#path"></a>
</h4>
<p>{ss3sim} relies the Stock Synthesis executable being available to the
operating system. Thus, the executable must be in your path, which is a
list of directories that your operating system has access to and
searches through when a program is called. Having Stock Synthesis in
your path allows {ss3sim} to use the name of the single, saved
executable instead of requiring the full path or copying the executable
to every local directory before calling it, which saves on space because
the Stock Synthesis binary is about 6 MB. This functionality of not
copying the executable works even when <a href="#parallel">running Stock
Synthesis in parallel</a>.</p>
<p>{ss3sim} will first look to see if the executable is available in
your R library using
<code>system.file("bin", package = "ss3sim")</code>. The previous will
only lead to a viable file path if you are using the GitHub version of
{ss3sim} because the distribution of executables is not allowed on CRAN.
If the location is not returned from <code>system.file</code>, R will
look for the executable in your path. This hierarchy is important for
understanding which version of Stock Synthesis is being used because you
might already have a version of Stock Synthesis in your path.</p>
<p>{ss3sim} was originally based on Stock Synthesis 3.24O <span class="citation">(Anderson et al. 2014)</span> and did not immediately
update to use Stock Synthesis 3.30. In 2019, {ss3sim} was updated to use
Stock Synthesis 3.30, and <strong>users can count on future versions of
{ss3sim} being up to date with the newest version of Stock
Synthesis.</strong> Stock Synthesis will end development with
major-version three but minor versions will continue to be updated for
quite some time.</p>
<p>If you are using the CRAN version of {ss3sim}, reference <a href="https://nmfs-stock-synthesis.github.io/ss-documentation/Getting_Started_SS.html" title="Stock Synthesis Getting Started documentation" class="external-link">Getting Started
with Stock Synthesis</a> for instructions on how to put Stock Synthesis
in your path. Or, you can mimic the directory structure of the GitHub
version of {ss3sim} and place the executable in the appropriate folder
below</p>
<pre><code>├──library
|  └──ss3sim
|  |  ├──bin
|  |  |  ├──Linux64
|  |  |  ├──MacOS
|  |  |  └──Windows64</code></pre>
<p>But, the executable will need to be updated every time you reinstall
{ss3sim}.</p>
<p>Compiled Stock Synthesis executables are available for multiple
operating systems <a href="https://github.com/ss3sim/ss3sim/tree/main/inst/bin" title="Stock Synthesis executables on GitHub in ss3sim" class="external-link">on GitHub</a> or
in <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis/actions" title="Stock Synthesis GitHub actions" class="external-link">GitHub actions in the Stock
Synthesis repository</a>.</p>
</div>
<div class="section level4">
<h4 id="installing-dependent-r-packages">Installing dependent R packages<a class="anchor" aria-label="anchor" href="#installing-dependent-r-packages"></a>
</h4>
<p>Installing {ss3sim} will install all of the necessary dependent
packages without users needing to do anything extra. But, for
completeness and as an acknowledgement, below we highlight a few
packages that are essential for running {ss3sim}.</p>
<div class="section level5">
<h5 id="r4ss">{r4ss}<a class="anchor" aria-label="anchor" href="#r4ss"></a>
</h5>
<p>If you are using the GitHub version of {ss3sim}, R will install the
<a href="https://github.com/r4ss/r4ss" title="r4ss on GitHub" class="external-link">GitHub
version of {r4ss}</a>. If you are using the CRAN version of {ss3sim}, R
will install the <a href="https://cran.r-project.org/package=r4ss" title="r4ss on CRAN" class="external-link">CRAN version of {r4ss}</a>. Both methods will check
to make sure that you have the appropriate version of {r4ss} in your R
library given the mirror you are using. Feel free to install {r4ss}
directly via</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"r4ss/r4ss"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>But, make sure you do it before loading {ss3sim}. If you forget, you
can use <code>devtools::unload(package = "ss3sim")</code> and then
reinstall {r4ss}.</p>
</div>
<div class="section level5">
<h5 id="ggplot2">{ggplot2}<a class="anchor" aria-label="anchor" href="#ggplot2"></a>
</h5>
<p><a href="https://ggplot2.tidyverse.org/" title="ggplot2 documentation" class="external-link">{ggplot2}</a> uses the <a href="https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448/ref=as_li_ss_tl" title="Grammar of Graphics on Amazon" class="external-link">Grammar of Graphics</a> to
decoratively create images that represent things in a tidy way. We do
not force users to use {ggplot2}. All output is available in *.csv files
and can be visualized using base R if you prefer. The easiest way to get
{ggplot2} is to install the whole tidyverse suite.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h3>
<p>Simulations are composed of scenarios, i.e., unique sets of changes
to the OM and EM. <code><a href="../reference/run_ss3sim.html">run_ss3sim()</a></code> uses <code>simdf</code> to
specify the setup of scenarios within a simulation. <code>simdf</code>
stands for simulation data frame. The rows of the data frame store
scenario-level information. The columns of the data frame store function
arguments. Arguments can be direct arguments of
<code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code> or functions called by
<code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code> such as <code><a href="../reference/change_f.html">change_f()</a></code>. You only
need to specify columns for the arguments that you want to change. That
is, you do not have to have a column for every argument of all functions
called by <code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code>. To get a feel for the columns
needed in the <code>simdf</code> data frame run the following code,
where the output can be saved and used to build <code>simdf</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_scenarios_defaults.html">setup_scenarios_defaults</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Column entries of <code>simdf</code> need to be quoted if they are to
be evaluated later, e.g., <code>"seq(1,10,by=2)"</code> and
<code>"c('NatM_uniform_Fem_GP_1', 'L_at_Amin_Fem_GP_1')"</code>. Scalar
values can numeric. Use single quotes inside of double quotes to quote
text. Developers of {ss3sim} are working on a better, more
tidyverse-like non-standard evaluation method such that quotes will not
be needed. Feel free to reach out if you would like to help with this
effort or have ideas on how to make it work better.</p>
<p>Column names of <code>simdf</code> are key. You can specify any input
argument to <code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code> as a column of
<code>simdf</code>.</p>
<table class="table">
<thead><tr class="header">
<th>{ss3sim} function</th>
<th align="center">Argument</th>
<th align="right">Description</th>
</tr></thead>
<tbody><tr class="odd">
<td><code>ss3sim_base</code></td>
<td align="center"><code>bias_adjust</code></td>
<td align="right">Perform bias adjustment</td>
</tr></tbody>
</table>
<p>For functions that are called by <code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code> you need
to use the following rules to create appropriate column names:</p>
<ul>
<li>abbreviation of the function name (see the table below),</li>
<li>full stop,</li>
<li>the argument name,</li>
<li>full stop, and</li>
<li>integers to specify which fleet the column pertains to.</li>
</ul>
<p>For example, <code>cf.years.1</code> passes information to the
<code>year</code> argument of <code><a href="../reference/change_f.html">change_f()</a></code> for fleet 1.
<code>cf.years.2</code> passes information to the <code>year</code>
argument of <code><a href="../reference/change_f.html">change_f()</a></code> for fleet 2. Function abbreviations
are as follows:</p>
<table class="table">
<thead><tr class="header">
<th>{ss3sim} function</th>
<th align="center">Prefix</th>
<th align="right">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/change_f.html">change_f()</a></code></td>
<td align="center"><code>cf.</code></td>
<td align="right">Fishing mortality</td>
</tr>
<tr class="even">
<td><code><a href="../reference/change_e.html">change_e()</a></code></td>
<td align="center"><code>ce.</code></td>
<td align="right">Estimation</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/change_o.html">change_o()</a></code></td>
<td align="center"><code>co.</code></td>
<td align="right">Operating model</td>
</tr>
<tr class="even">
<td><code><a href="../reference/change_tv.html">change_tv()</a></code></td>
<td align="center"><code>ct.</code></td>
<td align="right">Time-varying OM parameter</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/change_data.html">change_data()</a></code></td>
<td align="center"><code>cd.</code></td>
<td align="right">Available OM data, bins, etc.</td>
</tr>
<tr class="even">
<td><code><a href="../reference/change_em_binning.html">change_em_binning()</a></code></td>
<td align="center"><code>cb.</code></td>
<td align="right">Available EM data bins</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/change_retro.html">change_retro()</a></code></td>
<td align="center"><code>cr.</code></td>
<td align="right">Retrospective year</td>
</tr>
<tr class="even">
<td><code><a href="../reference/sample_index.html">sample_index()</a></code></td>
<td align="center"><code>si.</code></td>
<td align="right">Index data</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/sample_agecomp.html">sample_agecomp()</a></code></td>
<td align="center"><code>sa.</code></td>
<td align="right">Age-composition data</td>
</tr>
<tr class="even">
<td><code><a href="../reference/sample_lcomp.html">sample_lcomp()</a></code></td>
<td align="center"><code>sl.</code></td>
<td align="right">Length-composition data</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/sample_calcomp.html">sample_calcomp()</a></code></td>
<td align="center"><code>sc.</code></td>
<td align="right">Conditional age-at-length data</td>
</tr>
<tr class="even">
<td><code><a href="../reference/sample_mlacomp.html">sample_mlacomp()</a></code></td>
<td align="center"><code>sm.</code></td>
<td align="right">Mean length-at-age data</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/sample_wtatage.html">sample_wtatage()</a></code></td>
<td align="center"><code>sw.</code></td>
<td align="right">Weight-at-age data</td>
</tr>
</tbody>
</table>
<p>Currently, fishing mortality, indices of abundance, and either age-
or length-composition data are mandatory for a scenario.</p>
</div>
<div class="section level3">
<h3 id="file-structure">File structure<a class="anchor" aria-label="anchor" href="#file-structure"></a>
</h3>
<div class="section level4">
<h4 id="input-file-structure">Input file structure<a class="anchor" aria-label="anchor" href="#input-file-structure"></a>
</h4>
<p>{ss3sim} comes with a generic, built-in operating model (OM) and
estimation method (EM). The life history for these available files is
based on a cod-like fish. You can peruse the files if you have {ss3sim}
installed here</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/models"</span>, package <span class="op">=</span> <span class="st">"ss3sim"</span><span class="op">)</span></span></code></pre></div>
<p>These model files can be used as is, modified, or replaced. For more
details on how to modify or replace the default models, see the
vignettes on <a href="modifying-models.html">modifying model setups</a>
and <a href="making-models.html">creating your own OM and EMs</a>.</p>
<p>You can have as many OMs and EMs as you want in your simulation. The
collection of files for each OM and EM should be in its own directory,
just like the example OM and EM.</p>
</div>
<div class="section level4">
<h4 id="simulation-file-structure">Simulation file structure<a class="anchor" aria-label="anchor" href="#simulation-file-structure"></a>
</h4>
<p>Internally, <code><a href="../reference/copy_ss3models.html">copy_ss3models()</a></code> creates the directory
structure for the simulations. After you run a simulation, directories
will be created in your working directory. Inside your working
directory, the structure will look like</p>
<pre><code><span>  <span class="va">scenarioA</span><span class="op">/</span><span class="fl">1</span><span class="op">/</span><span class="va">om</span></span>
<span>  <span class="va">scenarioA</span><span class="op">/</span><span class="fl">1</span><span class="op">/</span><span class="va">em</span></span>
<span>  <span class="va">scenarioA</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="va">om</span></span>
<span>  <span class="va">scenarioA</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="va">em</span></span>
<span>  <span class="va">scenarioB</span><span class="op">/</span><span class="fl">1</span><span class="op">/</span><span class="va">om</span></span>
<span>  <span class="va">scenarioB</span><span class="op">/</span><span class="fl">1</span><span class="op">/</span><span class="va">em</span></span>
<span>  <span class="va">...</span></span></code></pre>
<p>The integer values after the scenario represent iterations; the total
number of iterations is specified by the user. The OM and EM directories
are copied into individual directories for an iteration. Note that the
supplied OM and EM directories will be renamed <code>om</code> and
<code>em</code> within each iteration. There will be some additional
directories if you are using bias adjustment. See
<code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code> for more information on bias adjustment. You
can name the scenarios any combination of character values or use the
default naming system within {ss3sim} that uses the date and time.</p>
<p>The supplied OM and EM directories are checked to ensure</p>
<ul>
<li>they contain the minimal files,</li>
<li>the filenames are lowercase,</li>
<li>the data file is named <code>ss.dat</code>,</li>
<li>the control files are named <code>om.ctl</code> or
<code>em.ctl</code>, and</li>
<li>the starter files are adjusted to reflect these file names.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example">Example simulations with {ss3sim}<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>The example is based on the cod-like species in the papers <span class="citation">Ono et al. (2015)</span> and <span class="citation">Johnson et al. (2015)</span>, both of which used
{ss3sim}. All of the required files for this example are contained
within {ss3sim}. This example is a 2x2 design, testing</p>
<ol style="list-style-type: decimal">
<li>the effect of high and low precision on the index of abundance
provided by the survey and</li>
<li>the effect of fixing versus estimating natural mortality
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>).</li>
</ol>
<div class="section level3">
<h3 id="setting-up-the-example">Setting up the example<a class="anchor" aria-label="anchor" href="#setting-up-the-example"></a>
</h3>
<p>First we will create <code>df</code>, a data frame for
<code>run_ss3sim(simdf = df)</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the boiler-plate data frame available in {ss3sim} for 2 scenarios</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_scenarios_defaults.html">setup_scenarios_defaults</a></span><span class="op">(</span>nscenarios <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Turn off bias adjustment and use default settings in cod EM model</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"bias_adjust"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
<div class="section level4">
<h4 id="fishing-mortality">Fishing mortality<a class="anchor" aria-label="anchor" href="#fishing-mortality"></a>
</h4>
<p>Fishing mortality,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>,
is set to a constant percentage of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
at maximum sustainable yield,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">S</mi><mi mathvariant="normal">Y</mi></mrow></msub><annotation encoding="application/x-tex">F_\mathrm{MSY}</annotation></semantics></math>,
from when the fishery starts in year 26 until the end of the simulation
in year 100.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the default fishing mortality settings</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^cf\\."</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;   cf.years.1      cf.fvals.1</span></span>
<span><span class="co">#&gt; 1     26:100 rep(0.1052, 75)</span></span>
<span><span class="co">#&gt; 2     26:100 rep(0.1052, 75)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="composition-data">Composition data<a class="anchor" aria-label="anchor" href="#composition-data"></a>
</h4>
<p>Refer to the help files <code><a href="../reference/sample_lcomp.html">?sample_lcomp</a></code> and
<code><a href="../reference/sample_agecomp.html">?sample_agecomp</a></code> for detailed information on these
functions. The sampling theory is described in the <a href="#comps">age-
and length-composition sampling section</a>.</p>
<p>The default <code>simdf</code> contains sampling protocols for
composition data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display the default composition-data settings</span></span>
<span><span class="co"># sa is for ages and sl is for lengths</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^s[al]\\."</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;   sl.Nsamp.1 sl.years.1 sl.Nsamp.2           sl.years.2 sl.cpar sa.Nsamp.1</span></span>
<span><span class="co">#&gt; 1         50     26:100        100 seq(62, 100, by = 2)    NULL         50</span></span>
<span><span class="co">#&gt; 2         50     26:100        100 seq(62, 100, by = 2)    NULL         50</span></span>
<span><span class="co">#&gt;   sa.years.1 sa.Nsamp.2           sa.years.2 sa.cpar</span></span>
<span><span class="co">#&gt; 1     26:100        100 seq(62, 100, by = 2)    NULL</span></span>
<span><span class="co">#&gt; 2     26:100        100 seq(62, 100, by = 2)    NULL</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="survey-index-of-abundance">Survey index of abundance<a class="anchor" aria-label="anchor" href="#survey-index-of-abundance"></a>
</h4>
<p>To investigate the effect of different levels of precision on the
survey index of abundance, we will manipulate <code>sds_obs</code> of
<code><a href="../reference/sample_index.html">sample_index()</a></code>. This argument ultimately refers to the
standard error of the natural log of yearly index values, as defined in
Stock Synthesis. In the first scenario <code>sds_obs = 0.1</code>. In
the second scenario <code>sds_obs = 0.4</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a biennial survey starting in year 76 and ending in the terminal year</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"si.years.2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"seq(76, 100, by = 2)"</span></span>
<span><span class="co"># Set sd of observation error for each scenario</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"si.sds_obs.2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-parameters">Estimating parameters<a class="anchor" aria-label="anchor" href="#estimating-parameters"></a>
</h4>
<p>To investigate the effect of fixing versus estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>,
<code>df</code> must be augmented to call <code><a href="../reference/change_e.html">change_e()</a></code>. Using
<code>par_phase</code> one can turn a parameter on and off in the EM,
where negative phases tells Stock Synthesis to not estimate the
parameter. The second scenario will estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
in phase <code>3</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"ce.par_name"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"NatM_uniform_Fem_GP_1"</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"ce.par_int"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="co"># Set the phase for estimating natural mortality</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"ce.par_phase"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Name the scenarios</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"scenarios"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"D0-E0-F0-cod"</span>, <span class="st">"D1-E0-F0-cod"</span>,</span>
<span>  <span class="st">"D0-E1-F0-cod"</span>, <span class="st">"D1-E1-F0-cod"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualizing-the-results">Visualizing the results<a class="anchor" aria-label="anchor" href="#visualizing-the-results"></a>
</h3>
<p>Five iterations is unrealistic for a manuscript but saves time and
disk space here. You can assess how many iterations are needed to
stabilize the results using <code><a href="../reference/plot_cummean.html">plot_cummean()</a></code>, which plots the
mean relative error on the y as additional iterations. The goal is to
run plenty of iterations, such that additional iterations no longer
appreciably flatten the curve towards a relative error of zero.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">scname</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ss3sim.html">run_ss3sim</a></span><span class="op">(</span>iterations <span class="op">=</span> <span class="va">iterations</span>, simdf <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p>A quick test that can be helpful is visualizing the patterns of
spawning stock biomass from the OM and the EM using r4ss.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_om</span> <span class="op">&lt;-</span> <span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_output.html" class="external-link">SS_output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">scname</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"1"</span>, <span class="st">"om"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>, printstats <span class="op">=</span> <span class="cn">FALSE</span>, covar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r_em</span> <span class="op">&lt;-</span> <span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_output.html" class="external-link">SS_output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">scname</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"1"</span>, <span class="st">"em"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>, printstats <span class="op">=</span> <span class="cn">FALSE</span>, covar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSplotComparisons.html" class="external-link">SSplotComparisons</a></span><span class="op">(</span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSsummarize.html" class="external-link">SSsummarize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">r_om</span>, <span class="va">r_em</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  legendlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OM"</span>, <span class="st">"EM"</span><span class="op">)</span>, subplots <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Each iteration is unique because of process error included through
normally-distributed recruitment deviations. Thus, if you were to plot
the OMs from iteration one and two using
<code><a href="https://r4ss.github.io/r4ss/reference/SSplotComparisons.html" class="external-link">r4ss::SSplotComparisons()</a></code> there would be clear annual
differences. Deviations are generated for each iteration in your
simulation and used across scenarios. Using the same deviations for
iteration one of each scenario, and a different set of deviations for
each additional iteration, facilitates comparisons across scenarios. The
default distribution in {ss3sim} has a mean of <code>-0.5</code> and a
standard deviation of <code>1</code> (bias-corrected standard-normal
deviations). These deviations are then scaled by the level of
recruitment variability specified in the OM with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\sigma_r</annotation></semantics></math>.
If you would like to specify your own deviations, you can pass them
using <code>user_recdevs</code>. See the next section on <a href="#deterministic">self tests</a> for an example of
<code>user_recdevs</code>.</p>
</div>
<div class="section level3">
<h3 id="deterministic">Self test to check for bias<a class="anchor" aria-label="anchor" href="#deterministic"></a>
</h3>
<p>Self testing is a crucial step of any simulation study to confirm
that parameters are identifiable. One way to ensure the dynamics are
what they were intended to be is to set up an EM that is similar to the
OM and include minimal process and observation error in the OM. We
recommend minimal and not zero error. Stability issues will arise in
non-linear, integrated models that assume error structures when there is
in fact none.</p>
<div class="section level4">
<h4 id="setup-self-test">Setup self test<a class="anchor" aria-label="anchor" href="#setup-self-test"></a>
</h4>
<p>We will start by setting up a 200 row (number of years) by 20 column
(number of iterations) matrix of recruitment deviations, where all
values are set to zero.</p>
<p>Then, we will set up OM and EM files with the standard deviation of
recruitment variability, <code>SR_sigmaR</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>R</mi></msub><annotation encoding="application/x-tex">\sigma_R</annotation></semantics></math>,
set to <code>0.001</code>. To do this, the data frame that controls the
scenarios must specify <code>par_name = SR_sigmaR</code> (the Stock
Synthesis parameter name) and <code>par_int = 0.001</code> (the initial
value) for both <code>change_o</code> and <code>change_e</code> for the
OM and EM, respectively. To minimize observation error on the survey
index, we will create a standard deviation on the survey observation
error of 0.001. Finally, we will fix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
at the true value and estimate it in phase 3 as we did before.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_scenarios_defaults.html">setup_scenarios_defaults</a></span><span class="op">(</span>nscenarios <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"user_recdevs"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"matrix(0, nrow = 200, ncol = 20)"</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"co.par_name"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"SR_sigmaR"</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"co.par_int"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"ce.par_name"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"SR_sigmaR"</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"ce.par_int"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"ce.par_phase"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"ce.forecast_num"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"si.years.2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"seq(60, 100, by = 2)"</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"si.sds_obs.2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"ce.par_name"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'c("SR_sigmaR", "NatM_uniform_Fem_GP_1")'</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"ce.par_int"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"c(0.001, NA)"</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="fl">2</span>, <span class="st">"ce.par_phase"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"c(-1, 3)"</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"scenarios"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D1-E100-F0-cod"</span>, <span class="st">"D1-E101-F0-M1-cod"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"bias_adjust"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-self-test">Run self-test<a class="anchor" aria-label="anchor" href="#run-self-test"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">scname_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ss3sim.html">run_ss3sim</a></span><span class="op">(</span>iterations <span class="op">=</span> <span class="va">iterations</span>, simdf <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="checking-output">Checking output<a class="anchor" aria-label="anchor" href="#checking-output"></a>
</h4>
<p>Check the model results to make sure that the EM returns the same
parameters as the OM. <code><a href="../reference/get_results_all.html">get_results_all()</a></code> should be
sufficient here, which will produce csv files that you can use to check
parameter estimates. For more details see the <a href="#beautiful-output">section on model output</a>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="beautiful-output">Beautiful output<a class="anchor" aria-label="anchor" href="#beautiful-output"></a>
</h2>
<div class="section level3">
<h3 id="csv-files">.csv files<a class="anchor" aria-label="anchor" href="#csv-files"></a>
</h3>
<p><code><a href="../reference/get_results_all.html">get_results_all()</a></code> reads in a set of scenarios and
combines the output into <code>.csv</code> files, e.g.,
<code>ss3sim_scalar.csv</code> and <code>ss3sim_ts.csv</code>. The
<code>scalar</code> file contains values for which there is a single
estimated value, e.g., MSY. The <code>ts</code> file refers to values
for which there are time series of estimated values, e.g., biomass for
each year.</p>
<p>Parameter names in these files will not always be the same across
simulations because names are dependent on OM and EM settings. For
example, an EM with age-specific natural mortality will have multiple
natural mortality parameters each with a different name based on the age
they pertain to. <code><a href="../reference/get_results_all.html">get_results_all()</a></code> accommodates this by
using the parameter name assigned by Stock Synthesis rather than
attempting to standardize names.</p>
<p>Originally, {ss3sim} provided the results using a wide-table format,
with individual columns for each OM and EM parameter along with some
summary information for each scenario. In May of 2020 we changed to
providing results using a tidier long format.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_results_all.html">get_results_all</a></span><span class="op">(</span></span>
<span>  overwrite_files <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  user_scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">scname</span>, <span class="va">scname_det</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Read in the data frames stored in the csv files</span></span>
<span><span class="va">scalar_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"ss3sim_scalar.csv"</span><span class="op">)</span></span>
<span><span class="va">ts_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"ss3sim_ts.csv"</span><span class="op">)</span></span></code></pre></div>
<p>If you would like to follow along with the rest of the vignette
without running the simulations detailed above, you can load a saved
version of the output.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"scalar_dat"</span>, package <span class="op">=</span> <span class="st">"ss3sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ts_dat"</span>, package <span class="op">=</span> <span class="st">"ss3sim"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="post-processing-of-results">Post-processing of results<a class="anchor" aria-label="anchor" href="#post-processing-of-results"></a>
</h3>
<div class="section level4">
<h4 id="calculate-the-relative-error-re">Calculate the relative error (RE)<a class="anchor" aria-label="anchor" href="#calculate-the-relative-error-re"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scalar_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_re.html">calculate_re</a></span><span class="op">(</span><span class="va">scalar_dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (..., deparse.level = 1) : number of columns of result is</span></span>
<span><span class="co">#&gt; not a multiple of vector length (arg 1)</span></span>
<span><span class="va">ts_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_re.html">calculate_re</a></span><span class="op">(</span><span class="va">ts_dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (..., deparse.level = 1) : number of columns of result is</span></span>
<span><span class="co">#&gt; not a multiple of vector length (arg 1)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="merge-scalar-and-time-series">Merge scalar and time series<a class="anchor" aria-label="anchor" href="#merge-scalar-and-time-series"></a>
</h4>
<p>The gradient information is in the scalar file. Merging the scalar
and the time series can help add details to figures.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scalar_dat</span><span class="op">[</span>, <span class="st">"D"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"D([0-9]+)-.+"</span>,</span>
<span>  replacement <span class="op">=</span> <span class="st">"D\\1"</span>,</span>
<span>  <span class="va">scalar_dat</span><span class="op">[</span>, <span class="st">"scenario"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">scalar_dat</span><span class="op">[</span>, <span class="st">"E"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  test <span class="op">=</span> <span class="va">scalar_dat</span><span class="op">$</span><span class="va">NatM_uniform_Fem_GP_1_em</span> <span class="op">==</span> <span class="fl">0.2</span>,</span>
<span>  <span class="st">"fix M"</span>,</span>
<span>  <span class="st">"estimate M"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ts_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ts_dat</span>, <span class="op">-</span><span class="va">E</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="va">scalar_dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scenario"</span>, <span class="st">"iteration"</span>, <span class="st">"max_grad"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="separate-the-deterministic-from-the-stochastic-runs">Separate the deterministic from the stochastic runs<a class="anchor" aria-label="anchor" href="#separate-the-deterministic-from-the-stochastic-runs"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_dat_sto</span> <span class="op">&lt;-</span> <span class="va">ts_dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"E[0-1]-"</span>, <span class="va">ts_dat</span><span class="op">[</span>, <span class="st">"scenario"</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">scalar_dat_long</span> <span class="op">&lt;-</span> <span class="va">scalar_dat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scalar_dat_long</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"(.+)_re"</span>,</span>
<span>  replacement <span class="op">=</span> <span class="st">"RE _\\1"</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scalar_dat_long</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">scalar_dat_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">scalar_dat_long</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">" _"</span>,</span>
<span>  direction <span class="op">=</span> <span class="st">"long"</span>,</span>
<span>  varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">" _"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scalar_dat_long</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scenario"</span>, <span class="st">"iteration"</span><span class="op">)</span>,</span>
<span>  timevar <span class="op">=</span> <span class="st">"parameter"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="boxplots">Boxplots<a class="anchor" aria-label="anchor" href="#boxplots"></a>
</h3>
<p>Use the long data to create a multi-panel plot with {ggplot2}.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_boxplot.html">plot_boxplot</a></span><span class="op">(</span></span>
<span>  <span class="va">scalar_dat_long</span><span class="op">[</span></span>
<span>    <span class="va">scalar_dat_long</span><span class="op">$</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depletion"</span>, <span class="st">"SSB_MSY"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"E10[0-1]"</span>, <span class="va">scalar_dat_long</span><span class="op">[</span>, <span class="st">"scenario"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="op">]</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"E"</span>, y <span class="op">=</span> <span class="st">"RE"</span>, re <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  horiz <span class="op">=</span> <span class="st">"parameter"</span>, print <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/relative-error-boxplots-det-1.png" alt="Box plots of the relative error (RE) for deterministic runs. $M$ is fixed at the true value from the OM (E100) or estimated (E101)." width="480"><p class="caption">
Box plots of the relative error (RE) for deterministic runs.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
is fixed at the true value from the OM (E100) or estimated (E101).
</p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see plot_points() for another plotting function</span></span></code></pre></div>
<p>While plotting the relative error in estimates of spawning biomass,
one can add color to the time series according to the maximum gradient.
Small values of the maximum gradient (approximately 0.001 or less)
indicate that model convergence is likely. Larger values (greater than
1) indicate that model convergence is unlikely. Results of individual
iterations are jittered around the vertical axis to aid in
visualization. The following three blocks of code produce Figures~, ,
and .</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_lines.html">plot_lines</a></span><span class="op">(</span><span class="va">ts_dat_sto</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"SpawnBio_re"</span>,</span>
<span>  vert <span class="op">=</span> <span class="st">"E"</span>, horiz <span class="op">=</span> <span class="st">"D"</span>, print <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"max_grad"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/plot-sto-ts-1.png" alt="Time series of relative error in spawning stock biomass." width="672"><p class="caption">
Time series of relative error in spawning stock biomass.
</p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_boxplot.html">plot_boxplot</a></span><span class="op">(</span></span>
<span>  <span class="va">scalar_dat_long</span><span class="op">[</span></span>
<span>    <span class="va">scalar_dat_long</span><span class="op">$</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depletion"</span>, <span class="st">"SSB_MSY"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"E[0-1]-"</span>, <span class="va">scalar_dat_long</span><span class="op">$</span><span class="va">scenario</span><span class="op">)</span>,</span>
<span>  <span class="op">]</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"D"</span>, y <span class="op">=</span> <span class="st">"RE"</span>, re <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  vert <span class="op">=</span> <span class="st">"E"</span>, horiz <span class="op">=</span> <span class="st">"parameter"</span>, print <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/relative-error-boxplots-sto-1.png" alt="Box plots of relative error (RE) for stochastic runs. $M$ is fixed at the true value from the OM (E0) or estimated (E1). The standard deviation on the survey index observation error is 0.4 (D1) or 0.1 (D0), representing an increase in survey sampling effort." width="480"><p class="caption">
Box plots of relative error (RE) for stochastic runs.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
is fixed at the true value from the OM (E0) or estimated (E1). The
standard deviation on the survey index observation error is 0.4 (D1) or
0.1 (D0), representing an increase in survey sampling effort.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="stochasticity">Stochasticity<a class="anchor" aria-label="anchor" href="#stochasticity"></a>
</h2>
<div class="section level3">
<h3 id="obs-error">Generating observation error<a class="anchor" aria-label="anchor" href="#obs-error"></a>
</h3>
<p>The <code>sample_*()</code> functions work together to add
observation error to the expected values before creating the input
<code>.dat</code> file for the EM. Input arguments for these functions
have two primary tasks. First, they help decide what types of data are
included in the expected values. Second, they dictate how observation
error is added to the expectations.</p>
<div class="section level4">
<h4 id="calculate_data_units">
<code>calculate_data_units()</code><a class="anchor" aria-label="anchor" href="#calculate_data_units"></a>
</h4>
<p><code><a href="../reference/calculate_data_units.html">calculate_data_units()</a></code> is used to modify the OM to
include just the data types and quantities that are needed based on the
arguments passed to <code>sample_*()</code>. For example, you might wish
to fit an EM to conditional length-at-age data with a certain bin
structure for certain years and fleets. To do that, expected lengths and
ages must be available for appropriate years and fleets at a
sufficiently fine bin size. If you have many different scenarios in your
simulation, then there will be lots of combinations of expected values
that are needed.</p>
<p>Instead of generating every possible combination of years, fleets,
etc., which is slow and inefficient, {ss3sim} uses
<code><a href="../reference/calculate_data_units.html">calculate_data_units()</a></code> to determine the minimal-viable
amount of data types needed. For example, if arguments are passed to
<code><a href="../reference/sample_mlacomp.html">sample_mlacomp()</a></code>, then expected values for age and
length-at-age are created, even if <code><a href="../reference/sample_agecomp.html">sample_agecomp()</a></code> is not
being called directly. Similarly, <code><a href="../reference/sample_wtatage.html">sample_wtatage()</a></code> leads to
expected values for empirical weight-at-age, age-composition, and mean
length-at-age data. <code><a href="../reference/sample_calcomp.html">sample_calcomp()</a></code> leads to expected
values for length- and age-composition data.</p>
<p>Currently, {ss3sim} supports the sampling of the following types of
data:</p>
<ul>
<li>catch-per-unit effort data with <code><a href="../reference/sample_index.html">sample_index()</a></code>,</li>
<li>length and age compositions with <code><a href="../reference/sample_lcomp.html">sample_lcomp()</a></code> and
<code><a href="../reference/sample_agecomp.html">sample_agecomp()</a></code>,</li>
<li>mean length (size) at age <code><a href="../reference/sample_mlacomp.html">sample_mlacomp()</a></code>,</li>
<li>empirical weight at age with <code><a href="../reference/sample_wtatage.html">sample_wtatage()</a></code>, and</li>
<li>conditional age at length with <code><a href="../reference/sample_calcomp.html">sample_calcomp()</a></code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="distributional-assumptions-for-observation-error">Distributional assumptions for observation error<a class="anchor" aria-label="anchor" href="#distributional-assumptions-for-observation-error"></a>
</h4>
<p>In simulations, the true underlying dynamics of the population are
known, and therefore, a variety of sampling techniques are possible.
Ideal sampling, in the statistical sense, can be done easily. However,
there is some question about the realism behind providing the model with
this kind of data because it is unlikely to happen in practice <span class="citation">(Pennington et al. 2002)</span>. One way to generate
more realistic data is to use flexible distributions, which allow the
user to control the statistical properties, e.g., overdispersion of the
data. Another option is to use unmodeled process error, typically in
selectivity.</p>
<p>Under perfect mixing of fish and truly random sampling of the
population, the age samples would be multinomial. However, in practice
fish are never perfectly mixed because fish tend to aggregate by size
and age <span class="citation">(e.g., Pennington et al. 2002)</span>.
And, it is difficult to take random samples. Both of these sampling
properties can cause the data to have more variance than expected, i.e.,
be overdispersed, and the effective sample size is smaller than expected
<span class="citation">(Maunder 2011, Hulson et al. 2012)</span>. For
example, if a multinomial likelihood is assumed for overdispersed data,
the model puts too much weight on those data by thinking they should be
less variable than they are, at the cost of fitting other data less well
<span class="citation">(Maunder 2011)</span>. Analysts thus often “tune”
their model to find a sample size, i.e., “effective sample size”, that
is more appropriate than the “input sample size”. The effective sample
size will in theory more accurately reflect the information in the
composition data <span class="citation">(Francis and Hilborn
2011)</span>. In our case, we exactly control how the data are generated
and specified in the EM, providing a large amount of flexibility to the
user. What is optimal will depend on the questions addressed by a
simulation and how the results are meant to be interpreted. We caution
users to carefully consider how data are generated and fit.</p>
<div class="section level5">
<h5 id="indices-of-abundance">Indices of abundance<a class="anchor" aria-label="anchor" href="#indices-of-abundance"></a>
</h5>
<p><code><a href="../reference/sample_index.html">sample_index()</a></code> facilitates generating relative indices
of abundance (catch-per-unit-effort (CPUE) data for fishery fleets). It
samples from the biomass trends available for the different fleets to
simulate the collection of CPUE and survey index data. The user can
specify which fleets are sampled in which years and with what amount of
noise. Different fleets will “see” different biomass trends due to
differences in selectivity. Catchability for the OM is equal to one,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">q=1</annotation></semantics></math>,
and thus, the indices are actually absolute indices of (spawning)
biomass.</p>
<p>In practice, sampling from the abundance indices is relatively
straightforward. The OM <code>.dat</code> file contains the annual
biomass values for each fleet, and the <code>sample_index</code>
function uses these true values as the mean of a distribution. The
function uses a bias-corrected log-normal distribution with expected
values given by the OM biomass and a user-provided standard deviation
term that controls the level of variance.</p>
<p>More specifically, let</p>
<p><span class="math display">$$\begin{aligned}
  B_y&amp;=\text{the true (OM) biomass in year $y$}\newline
  \sigma_y&amp;=\text{the standard deviation provided by the
user}\newline
  X\sim N(0, \sigma_y^2)&amp;=\text{a normal random variable}
\end{aligned}$$</span></p>
<p>then the sampled value,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>B</mi><mi>y</mi><mtext mathvariant="normal">obs</mtext></msubsup><annotation encoding="application/x-tex">B_y^\text{obs}</annotation></semantics></math>
is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>y</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>=</mo><msub><mi>B</mi><mi>y</mi></msub><msup><mi>e</mi><mrow><mi>X</mi><mo>−</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mi>/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">B_y^\text{obs}=B_y e^{X-\sigma_y^2/2}</annotation></semantics></math></p>
<p>which has expected value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>B</mi><mi>y</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>B</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">\mathrm{E}\left[B_y^\text{obs}\right]=B_y</annotation></semantics></math>
due to the bias adjustment term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\sigma_y^2/2</annotation></semantics></math>
(<code>SR_sigmaR</code> in Stock Synthesis). This process generates
log-normal values centered at the true value. It is possible for the
user to specify the amount of uncertainty, e.g., to mimic the amount of
survey effort. But currently, it is not possible to induce bias in this
process.</p>
<div class="section level6">
<h6 id="effective-sample-sizes">Effective sample sizes<a class="anchor" aria-label="anchor" href="#effective-sample-sizes"></a>
</h6>
<p>For index data, which are assumed by Stock Synthesis to follow a
log-normal distribution, the weight of the data is determined by the CV
of each point. As the CV increases, the data have less weight in the
joint likelihood. This is equivalent to decreasing the effective sample
size in other distributions. {ss3sim} sets these values automatically at
the truth internally, although future versions may allow for more
complex options. The user-supplied
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\sigma_y</annotation></semantics></math>
term is written to the <code>.dat</code> file along with the sampled
values. So, the EM has the correct level of uncertainty. Thus, the EM
has unbiased estimates of both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>y</mi></msub><annotation encoding="application/x-tex">B_y</annotation></semantics></math>
and the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\sigma_y</annotation></semantics></math>
for all fleets in all years sampled.</p>
</div>
</div>
<div class="section level5">
<h5 id="comps">Age and length compositions<a class="anchor" aria-label="anchor" href="#comps"></a>
</h5>
<p><code><a href="../reference/sample_agecomp.html">sample_agecomp()</a></code> and <code><a href="../reference/sample_lcomp.html">sample_lcomp()</a></code> sample
from the true age and length compositions using either a multinomial or
Dirichlet distribution. The user can specify which fleets are sampled in
which years and with what amount of noise (via sample size).</p>
<p>The following calculations are shown for how age-composition-data is
sampled. But, the equations apply equally to how length-composition data
is sampled as well. The multinomial distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐦</mi><mo>∼</mo><mtext mathvariant="normal">MN</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐩</mi><mo>,</mo><mi>n</mi><mo>,</mo><mi>A</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{m} \sim \text{MN}\left(\mathbf{p}, n, A\right )</annotation></semantics></math>
is defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>𝐦</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>m</mi><mi>A</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mrow><mtext mathvariant="normal">the number of fish observed in bin </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>𝐩</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>p</mi><mi>A</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mrow><mtext mathvariant="normal">the true proportion of fish in bin </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>n</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">sample size</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>A</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">number of age bins</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
 \mathbf{m} &amp;= m_1, \ldots, m_A\\
  &amp;=\text{the number of fish observed in bin $a$}\\
  \mathbf{p}&amp;= p_1, \ldots, p_A\\
  &amp;=\text{the true proportion of fish in bin $a$}\\
  n&amp;=\text{sample size} \\
  A&amp;=\text{number of age bins}
\end{aligned}</annotation></semantics></math></p>
<p>In the case of Stock Synthesis, actual proportions are input as data.
So,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐦</mi><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">\mathbf{m}/n</annotation></semantics></math>
is the distribution used instead of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐦</mi><annotation encoding="application/x-tex">\mathbf{m}</annotation></semantics></math>.
Thus, the variance of the estimated proportion for age bin
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>M</mi><mi>a</mi></msub><mi>/</mi><mi>n</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>p</mi><mi>a</mi></msub><msub><mi>q</mi><mi>a</mi></msub><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">\mathrm{Var}\left[M_a/n\right]=p_aq_a/n</annotation></semantics></math>.
Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>a</mi></msub><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">m_a/n</annotation></semantics></math>
can only take on values in the set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mi>/</mi><mi>n</mi><mo>,</mo><mn>2</mn><mi>/</mi><mi>n</mi><mo>,</mo><mi>…</mi><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{0, 1/n, 2/n, \ldots, 1\}</annotation></semantics></math>.
With sufficiently large sample size this set approximates the real
interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>.
But, the key point being that only a finite set of rational values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>a</mi></msub><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">m_a/n</annotation></semantics></math>
are possible.</p>
<p>The multinomial, as described above, is based on assumptions of ideal
sampling and is likely unrealistic, particularly with large sample
sizes. One strategy to add realism is to allow for overdispersion.</p>
<div class="section level6">
<h6 id="sampling-with-overdispersion">Sampling with overdispersion<a class="anchor" aria-label="anchor" href="#sampling-with-overdispersion"></a>
</h6>
<p>Users can specify the level of overdispersion present in the sampled
data through the argument <code>cpar</code>. <code>cpar</code> is the
ratio of the standard deviation between a multinomial and Dirichlet
distribution with the same probabilities and sample size. Thus, a value
of 1 would be the same standard deviation, while 2 would be twice the
standard deviation of a multinomial (overdispersed). {ss3sim} also
currently allows for specifying the effective sample sizes used as input
for the EM separately from the sample sizes used to sample the data. See
<code><a href="../reference/sample_agecomp.html">?sample_agecomp</a></code> and <code><a href="../reference/sample_lcomp.html">?sample_lcomp</a></code> for more
detail.</p>
<p>This Dirichlet distribution has the same range and mean as the
multinomial. But, the distribution has a different variance controlled
by a parameter. The variance is determined exclusively by the cell
probabilities and sample size n the multinomial, making it more flexible
than the multinomial. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐝</mi><mo>∼</mo><mtext mathvariant="normal">Dirichlet</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛂</mi><mo>,</mo><mi>A</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{d} \sim \text{Dirichlet}\left (\boldsymbol{\alpha}, A\right )</annotation></semantics></math>
be a Dirichlet random vector. It is characterized by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>𝐝</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>d</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>d</mi><mi>A</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mrow><mtext mathvariant="normal">the proportion of fish observed in bin </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>𝛂</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>α</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>α</mi><mi>A</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mrow><mtext mathvariant="normal">concentration parameters for the proportion of fish in bin </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>A</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">number of age bins</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
  \mathbf{d} &amp;= d_1, \ldots, d_A\\
  &amp;=\text{the proportion of fish observed in bin $a$}\\
  \boldsymbol{\alpha}&amp;= \alpha_1, \ldots, \alpha_A\\
  &amp;=\text{concentration parameters for the proportion of fish in bin $a$}\\
  A&amp;=\text{number of age bins}
\end{aligned}</annotation></semantics></math></p>
<p>When using the Dirichlet distribution to generate random samples, it
is convenient to parameterize the vector of concentration parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛂</mi><annotation encoding="application/x-tex">\boldsymbol{\alpha}</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>𝐩</mi></mrow><annotation encoding="application/x-tex">\lambda \mathbf{p}</annotation></semantics></math>
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>a</mi></msub><mo>=</mo><mi>λ</mi><msub><mi>p</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_a=\lambda p_a</annotation></semantics></math>.
The mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>a</mi></msub><annotation encoding="application/x-tex">d_a</annotation></semantics></math>
is then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>d</mi><mi>a</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>p</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\mathrm{E}\left[d_a\right]=p_a</annotation></semantics></math>.
The variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>d</mi><mi>a</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>p</mi><mi>a</mi></msub><msub><mi>q</mi><mi>a</mi></msub></mrow><mrow><mi>λ</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{Var}\left[d_a\right]=\frac{p_aq_a}{\lambda+1}</annotation></semantics></math>.
The marginal distributions for the Dirichlet are beta distributed. In
contrast to the multinomial, the Dirichlet generates points on the real
interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>.</p>
<p>The following steps are used to generate overdispersed samples:</p>
<ul>
<li>Get the true proportions at age from OM for the number of age bins
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>.</li>
<li>Determine a realistic sample size, say
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n=100</annotation></semantics></math>.
Calculate the variance of the samples from a multinomial distribution,
call it
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><msub><mi>m</mi><mi>a</mi></msub></msub><annotation encoding="application/x-tex">V_{m_a}</annotation></semantics></math>.</li>
<li>Specify a level,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>,
that scales the standard deviation of the multinomial. Then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><msub><mi>V</mi><msub><mi>d</mi><mi>a</mi></msub></msub></msqrt><mo>=</mo><mi>c</mi><msqrt><msub><mi>V</mi><msub><mi>m</mi><mi>a</mi></msub></msub></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{V_{d_{a}}}=c\sqrt{V_{m_{a}}}</annotation></semantics></math>
from which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mi>n</mi><mi>/</mi><msup><mi>c</mi><mn>2</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda=n/c^2-1</annotation></semantics></math>
can be solved. Samples from the Dirichlet with this value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
will then give the appropriate level of variance. For instance, we can
generate samples with twice the standard deviation of the multinomial by
setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">c=2</annotation></semantics></math>
(this is <code>cpar</code>).</li>
</ul>
</div>
<div class="section level6">
<h6 id="effective-sample-sizes-1">Effective sample sizes<a class="anchor" aria-label="anchor" href="#effective-sample-sizes-1"></a>
</h6>
<p>The term “effective sample size” (ESS) for Stock Synthesis often
refers to the tuned sample size, right-weighted depending on the
information contained in the data. These values are estimated after an
initial run and then written to the .dat file and Stock Synthesis is run
again <span class="citation">(Francis and Hilborn 2011)</span>. Perhaps
a better term would be “input sample size” to contrast it with what was
originally sampled.</p>
<p>In any case, the default behavior for both multinomial and Dirichlet
generated composition data is to set the effective sample size
automatically in <code>sample_*()</code>. In the case of the
multinomial, the effective sample size is just the original sample size,
i.e., how many fish were sampled, the number of sampled tows, etc.
However, with the Dirichlet distribution, the effective sample size
depends on the parameters passed to these functions and is automatically
calculated internally and passed on to the <code>.dat</code> file. The
effective sample size is calculated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mo>=</mo><mi>n</mi><mi>/</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">N_{eff}=n/c^2</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
is <code>cpar</code>. Note that these values will not necessarily be
integer-valued and Stock Synthesis handles this without issue.</p>
<p>If the effective sample size is known and passed to the EM, there is
much similarity between the multinomial and Dirichlet methods for
generating data. The main difference arises when sample sizes
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>)
are small; in this case, the multinomial will be restricted to few
potential values (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi>/</mi><mi>n</mi><mo>,</mo><mn>1</mn><mi>/</mi><mi>n</mi><mo>,</mo><mi>…</mi><mo>,</mo><mi>n</mi><mi>/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">0/n, 1/n, \ldots, n/n</annotation></semantics></math>),
whereas the Dirichlet has values in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>.
Thus, without the Dirichlet it would be impossible to generate realistic
values that would come about from highly overdispersed data with a large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>.</p>
<p>The ability to is specify the ESS was implemented to allow for users
to explore data weighting issues. If you want to specify an
input/effective sample size different that what is used in sampling,
this is available via the <code>ESS</code> arguments of these two
functions.</p>
</div>
<div class="section level6">
<h6 id="structure-of-data-bins">Structure of data bins<a class="anchor" aria-label="anchor" href="#structure-of-data-bins"></a>
</h6>
<p>The ability of <code><a href="../reference/change_data.html">change_data()</a></code> is to modify the binning
structure of the data, not the population-level bins, is a lesser-known
feature of this function. The desired ages and length bins for the data
are specified in the arguments <code>len_bin</code> and
<code>age_bin</code> in <code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code>. These bins are
consistent across fleets, years, etc. Empirical weight-at-age data are a
special case because they are generated in a separate file and use the
population bins. Also, when either of these bin arguments are set to
<code>NULL</code> (the default value), the respective bins will match
those used in the OM.</p>
</div>
</div>
<div class="section level5">
<h5 id="mean-length-at-age">Mean length at age<a class="anchor" aria-label="anchor" href="#mean-length-at-age"></a>
</h5>
<p>The ability to sample mean-length-at-age data exists in ss3sim. But,
this sampling has not been thoroughly tested or used in a simulation
before. Contact the developers for more information.</p>
</div>
<div class="section level5">
<h5 id="conditional-age-at-length">Conditional age at length<a class="anchor" aria-label="anchor" href="#conditional-age-at-length"></a>
</h5>
<p>Conditional age-at-length (CAAL) data is an alternative to
age-composition data, when there are paired age and length observations
of the same fish. CAAL data are inherently tied to the length
compositions, e.g., as if a trip measured lengths and ages for all fish.
In contrast to the age compositions, which were generated independently
of the length data, e.g., as if one trip measured only ages and a second
only lengths. Stock Synthesis has the capability to associate the
measurements, and doing so has many appealing attributes. CAAL data are
expected to be more informative about growth than marginal
age-composition data. Although, to date, few studies have examined this
data type <span class="citation">(He et al. 2015, Monnahan et al.
2015)</span>. See <code>?sample_calcomp()</code> for more details on the
sampling process.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="pro-error">Generating process error<a class="anchor" aria-label="anchor" href="#pro-error"></a>
</h3>
<p>Process error is incorporated into the OM in the form of deviates in
recruitment (“recdevs”) from the stock-recruitment relationship. Unlike
the observation error, the process error affects the population dynamics
and thus must be done before running the OM.</p>
<p>These built-in recruitment deviations are standard normal deviates
and are multiplied by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\sigma_r</annotation></semantics></math>
(recruitment standard deviation) as specified in the OM, and bias
adjusted within {ss3sim}. That is,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">recdev</mtext><mi>i</mi></msub><mo>=</mo><msub><mi>σ</mi><mi>r</mi></msub><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><msubsup><mi>σ</mi><mi>r</mi><mn>2</mn></msubsup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \text{recdev}_i=\sigma_r z_i-\sigma_r^2/2
\end{equation*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">z_i</annotation></semantics></math>
is a standard normal deviate and the bias adjustment term
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>r</mi><mn>2</mn></msubsup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\sigma_r^2/2</annotation></semantics></math>)
makes the deviates have an expected value of 1 after exponentiation.</p>
<p>If the recruitment deviations are not specified, then {ss3sim} will
use these built-in recruitment deviations. Alternatively, you can
specify your own recruitment deviations, via the argument
<code>user_recdevs</code> to the top-level function
<code><a href="../reference/ss3sim_base.html">ss3sim_base()</a></code>. Ensure that you pass a matrix with at least
enough columns (iterations) and rows (years). The user-supplied
recruitment deviations are used exactly as specified (i.e., not
multiplied by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\sigma_r</annotation></semantics></math>
as specified in the Stock Synthesis model), and <strong>it is up to you
to bias correct them manually</strong> by subtracting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>r</mi><mn>2</mn></msubsup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\sigma_r^2 / 2</annotation></semantics></math>
as is done above. This functionality allows for flexibility in how the
recruitment deviations are specified, for example <a href="#deterministic">running deterministic runs</a> or adding serial
correlation.</p>
<p>Note that for both built-in and user-specified recdevs, {ss3sim} will
reuse the same set of recruitment deviations for all iterations across
scenarios. For example if you have two scenarios and run 100 iterations
of each, the same set of recruitment deviations are used for iteration
one for both those two scenarios.</p>
</div>
<div class="section level3">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a>
</h3>
<p>In many cases, you may want to make the observation and process error
reproducible. For instance, you may want to reuse process error so that
differences between scenarios are not confounded with process error.
More broadly, you may want to make a simulation reproducible on another
machine by another user (such as a reviewer).</p>
<p>By default {ss3sim} sets a seed based on the iteration number. This
will create the same recruitment deviations for a given iteration
number. You can therefore avoid having the same recruitment deviations
for a given iteration number by either specifying your own recruitment
deviation matrix. This can be done using the <code>user_recdevs</code>
argument or by changing the iteration numbers (e.g., using iterations
101 to 200 instead of 1 to 100). If you use the latter method, you must
specify a vector of iterations instead of a single number. The vector
will specify which numbers along a number line to use versus a single
number leads to 1:x iterations being generated. If you want the
different scenarios to have different process error you will need to
make separate calls to <code>run_ss3sim</code> for each scenario.</p>
<p>The observation error seed affecting the sampling of data is set
during the OM generation. Therefore, a given iteration-scenario-argument
combination will generate repeatable results. Given that different
arguments can generate different sampling routines, e.g., stochastically
sampling or not sampling from the age compositions or sampling a
different number of years, the observation error is not necessarily
comparable across different arguments.</p>
</div>
</div>
<div class="section level2">
<h2 id="detailed-features">Detailed features<a class="anchor" aria-label="anchor" href="#detailed-features"></a>
</h2>
<div class="section level3">
<h3 id="time-varying">Time-varying parameters in the OM<a class="anchor" aria-label="anchor" href="#time-varying"></a>
</h3>
<p>{ss3sim} includes the capability for inducing time-varying changes in
the OM using <code><a href="../reference/change_tv.html">change_tv()</a></code>. {ss3sim} currently does not have
built-in functions to turn on/off the estimation of time-varying
parameters in the EM. However, it is possible to create versions of an
EM with and without time-varying estimation of a parameter and specify
each EM in <code>simdf</code> using the <code>em</code> column. This
approach would allow for testing of differences between estimating a
single, constant parameter versus time-varying estimation of the same
parameter.</p>
<p><code><a href="../reference/change_tv.html">change_tv()</a></code> works by adding an environmental deviate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>n</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">env</annotation></semantics></math>)
to the base parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">par</annotation></semantics></math>),
creating a time varying parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">par</annotation></semantics></math>)
for each year
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>),</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><msub><mi>r</mi><mi>y</mi></msub><mo>=</mo><mi>p</mi><mi>a</mi><mi>r</mi><mo>+</mo><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi><mo>*</mo><mi>e</mi><mi>n</mi><msub><mi>v</mi><mi>y</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
par_y = par + link * env_y.
\end{equation}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">link</annotation></semantics></math>
is pre-specified to a value of one.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">par</annotation></semantics></math>
is the base value for the given parameter, as defined by the INIT value
in the <code>.ctl</code> file. For all catchability parameters
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>),
the deviate will be added to the log transform of the base parameter
using the following equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>q</mi><mi>y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>q</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi><mo>*</mo><mi>e</mi><mi>n</mi><msub><mi>v</mi><mi>y</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
  \log(q_{y}) = \log(q) + link * env_{y}.
\end{equation}</annotation></semantics></math></p>
<p>The vector of deviates must contain one value for every year of the
simulation and can be specified as zero for years in which the parameter
does not deviate from the base parameter value.</p>
<p>Currently, <code><a href="../reference/change_tv.html">change_tv()</a></code> function only works to add
time-varying properties to a time-invariant parameter. It cannot alter
the properties of parameters that already vary with time. Also, it will
not work with custom environmental linkages. Environmental linkages for
all parameters in the OM must be declared by a single line, i.e.,
<code>0 #_custom_mg-env_setup (0/1)</code> prior to using
<code><a href="../reference/change_tv.html">change_tv()</a></code>. Additionally, Stock Synthesis does not allow
more than one stock recruit parameter to vary with time. If the
<code>.ctl</code> file already has a stock recruit parameter that varies
with time and you try to implement another, the function will fail.</p>
<p>To pass arguments to <code>change_tv</code> through
<code>run_ss3sim</code> you need to create a column labeled
<code>ct.&lt;name of parameter&gt;</code>. Where you have to change
<code>name of parameter</code> to the parameter of interest. This
structure, where the column name includes the parameter name, allows for
multiple parameters to be time varying, you just have to use multiple
columns. Each column holds code to generate a vector of time series
information for a given parameter. The vectors are then combined into a
named list that is passed to <code>change_tv_list</code> in
<code><a href="../reference/change_tv.html">change_tv()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="parallel">Parallel computing with {ss3sim}<a class="anchor" aria-label="anchor" href="#parallel"></a>
</h3>
<p>{ss3sim} can easily run multiple scenarios in parallel to speed up
simulations. To run a simulation in parallel, you need to register
multiple cores or clusters using the package of your choice. Here, we
recommend using {parallel} and provide an example for you. First, find
out how many cores are on the computer and register a portion of those
for parallel processing. Second, us an apply function to get the results
from each scenario. Third, bring the results together and close the
cluster.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">ncls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"NUMBER_OF_PROCESSORS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"cl.cores"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ncls</span> <span class="op">&lt;</span> <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parSapply</a></span><span class="op">(</span><span class="va">cl</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">scname</span>, <span class="va">scname_det</span><span class="op">)</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">get_results_scenario</span>,</span>
<span>  overwrite_files <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_results_all.html">get_results_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>Note that if the simulation aborts for any reason while
<code><a href="../reference/run_ss3sim.html">run_ss3sim()</a></code> is running in parallel, you may need to abort
the left over parallel processes. On Windows, open the task manager
(Ctrl-Shift-Esc) and close any R processes. On a Mac, open Activity
Monitor and force quit any R processes. Also, if you are working with a
local development version of <code>ss3sim</code> and you are on a
Windows machine, you may not be able to run in parallel if you load
{ss3sim} with <code>devtools::load_all()</code>. Instead, do a full
install with <code>devtools::install()</code> (and potentially restart R
if {ss3sim} was already loaded).</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-anderson2014a" class="csl-entry">
Anderson, S.C., Monnahan, C.C., Johnson, K.F., Ono, K., and Valero, J.L.
2014. ss3sim: An <span>R</span> package for fisheries stock assessment
simulation with <span>Stock Synthesis</span>. PLOS ONE
<strong>9</strong>(4): e92725. doi: <a href="https://doi.org/10.1371/journal.pone.0092725" class="external-link">10.1371/journal.pone.0092725</a>.
</div>
<div id="ref-francis2011" class="csl-entry">
Francis, R.C., and Hilborn, R. 2011. Data weighting in statistical
fisheries stock assessment models. Canadian Journal of Fisheries and
Aquatic Sciences <strong>68</strong>(6): 1124–1138. NRC Research Press.
</div>
<div id="ref-he2015" class="csl-entry">
He, X., Field, J.C., Pearson, D.E., and Lefebvre, L.S. 2015. Age sample
sizes and their effects on growth estimation and stock assessment
outputs: Three case studies from u.s. West coast fisheries. Fisheries
Research: –. doi: <a href="https://doi.org/10.1016/j.fishres.2015.08.018" class="external-link">10.1016/j.fishres.2015.08.018</a>.
</div>
<div id="ref-hulson2012" class="csl-entry">
Hulson, P.-J.F., Hanselman, D.H., and Quinn, T.J. 2012. Determining
effective sample size in integrated age-structured assessment models.
ICES Journal of Marine Science: Journal du Conseil
<strong>69</strong>(2): 281–292. Oxford University Press.
</div>
<div id="ref-johnson2014" class="csl-entry">
Johnson, K.F., Monnahan, C.C., McGilliard, C.R., Vert-pre, K.A.,
Anderson, S.C., Cunningham, C.J., Hurtado-Ferro, F., Licandeo, R.R.,
Muradian, M.L., Ono, K., Szuwalski, C.S., Valero, J.L., Whitten, A.R.,
and Punt, A.E. 2015. Time-varying natural mortality in fisheries stock
assessment models: Identifying a default approach. ICES Journal of
Marine Science: Journal du Conseil <strong>72</strong>(1): 137–150. doi:
<a href="https://doi.org/10.1093/icesjms/fsu055" class="external-link">10.1093/icesjms/fsu055</a>.
</div>
<div id="ref-maunder2011" class="csl-entry">
Maunder, M.N. 2011. Review and evaluation of likelihood functions for
composition data in stock-assessment models: Estimating the effective
sample size. Fisheries Research <strong>109</strong>(2): 311–319.
Elsevier.
</div>
<div id="ref-monnahan2015" class="csl-entry">
Monnahan, C.C., Ono, K., Anderson, S.C., Rudd, M.B., Hicks, A.C.,
Hurtado-Ferro, F., Johnson, K.F., Kuriyama, P.T., Licandeo, R.R.,
Stawitz, C.C., Taylor, I.G., and Valero, J.L. 2015. The effect of length
bin width on growth estimation in integrated age-structured stock
assessments. Fisheries Research. doi: <a href="https://doi.org/10.1016/j.fishres.2015.11.002" class="external-link">10.1016/j.fishres.2015.11.002</a>.
</div>
<div id="ref-ono2014" class="csl-entry">
Ono, K., Licandeo, R., Muradian, M.L., Cunningham, C.J., Anderson, S.C.,
Hurtado-Ferro, F., Johnson, K.F., McGilliard, C.R., Monnahan, C.C.,
Szuwalski, C.S., Valero, J.L., Vert-Pre, K.A., Whitten, A.R., and Punt,
A.E. 2015. The importance of length and age composition data in
statistical age-structured models for marine species. ICES Journal of
Marine Science: Journal du Conseil <strong>72</strong>(1): 31–43. doi:
<a href="https://doi.org/10.1093/icesjms/fsu007" class="external-link">10.1093/icesjms/fsu007</a>.
</div>
<div id="ref-pennington2002" class="csl-entry">
Pennington, M., Burmeister, L.-M., Hjellvik, V., and others. 2002.
Assessing the precision of frequency distributions estimated from
trawl-survey samples. Fishery Bulletin <strong>100</strong>(1).
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kelli F. Johnson, Sean C. Anderson, Kathryn L. Doering, Cole C. Monnahan, Christine C. Stawitz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
